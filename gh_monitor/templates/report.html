<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GitHub Project Monitor Report</title>
    <style>
        * { box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f6f8fa;
            color: #24292f;
        }
        .layout {
            display: flex;
            min-height: 100vh;
        }
        .sidebar {
            width: 240px;
            background: white;
            border-right: 1px solid #d0d7de;
            padding: 16px 0;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
        }
        .sidebar h2 {
            font-size: 14px;
            padding: 8px 16px;
            margin: 0;
            color: #57606a;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .sidebar ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        .sidebar li a {
            display: block;
            padding: 8px 16px;
            color: #24292f;
            text-decoration: none;
            font-size: 14px;
            border-left: 3px solid transparent;
        }
        .sidebar li a:hover {
            background-color: #f6f8fa;
            border-left-color: #d0d7de;
        }
        .sidebar li a.has-prs {
            font-weight: 600;
        }
        .sidebar .pr-count {
            background: #0969da;
            color: white;
            font-size: 11px;
            padding: 2px 6px;
            border-radius: 10px;
            margin-left: 4px;
        }
        .main {
            margin-left: 240px;
            flex: 1;
            padding: 20px;
            max-width: 960px;
        }
        h1, h2, h3 { color: #1f2328; }
        .header { border-bottom: 1px solid #d0d7de; padding-bottom: 16px; margin-bottom: 24px; }
        .header p { color: #57606a; margin: 4px 0; font-size: 14px; }
        .summary { background: white; padding: 20px; border-radius: 6px; margin-bottom: 24px; border: 1px solid #d0d7de; }
        .repo-card { background: white; padding: 20px; border-radius: 6px; margin-bottom: 16px; border: 1px solid #d0d7de; }
        .repo-card h2 { margin-top: 0; }
        .status-pass { color: #1a7f37; }
        .status-fail { color: #cf222e; }
        .status-pending { color: #bf8700; }
        table { width: 100%; border-collapse: collapse; margin: 10px 0; }
        th, td { padding: 8px 12px; text-align: left; border-bottom: 1px solid #d0d7de; }
        th { background-color: #f6f8fa; }
        a { color: #0969da; text-decoration: none; }
        a:hover { text-decoration: underline; }
        .badge { display: inline-block; padding: 2px 8px; border-radius: 4px; font-size: 12px; }
        .badge-success { background-color: #dafbe1; color: #1a7f37; }
        .badge-failure { background-color: #ffebe9; color: #cf222e; }
        code { background-color: #f6f8fa; padding: 2px 6px; border-radius: 3px; font-family: monospace; font-size: 13px; }
        .stats { display: flex; gap: 20px; flex-wrap: wrap; }
        .stat { text-align: center; }
        .stat-value { font-size: 24px; font-weight: bold; }
        .stat-label { font-size: 12px; color: #57606a; }
        .commit-line {
            font-size: 14px;
            color: #57606a;
            margin: 8px 0;
        }
        .commit-line code { font-size: 12px; }
        .section { margin: 16px 0; }
        .section h3 { font-size: 14px; margin-bottom: 8px; }
        .ci-status { display: inline-flex; align-items: center; gap: 8px; margin: 8px 0; }
        .pages-link { margin: 8px 0; }
    </style>
</head>
<body>
    <div class="layout">
        <nav class="sidebar">
            <h2>Projects</h2>
            <ul>
            {% for repo in repositories %}
                <li>
                    <a href="#{{ repo.name }}"{% if repo.open_prs %} class="has-prs"{% endif %}>
                        {{ repo.name }}
                        {% if repo.open_prs %}<span class="pr-count">{{ repo.open_prs|length }}</span>{% endif %}
                    </a>
                </li>
            {% endfor %}
            </ul>
        </nav>

        <main class="main">
            <div class="header">
                <h1>GitHub Project Monitor</h1>
                <p>{{ timestamp }} | Last {{ scan_days }} days</p>
            </div>

            <div class="summary">
                <div class="stats">
                    <div class="stat">
                        <div class="stat-value">{{ total_repos }}</div>
                        <div class="stat-label">Repositories</div>
                    </div>
                    <div class="stat">
                        <div class="stat-value">{{ total_prs }}</div>
                        <div class="stat-label">Open PRs</div>
                    </div>
                    <div class="stat">
                        <div class="stat-value">{{ total_branches }}</div>
                        <div class="stat-label">Orphaned Branches</div>
                    </div>
                    <div class="stat">
                        <div class="stat-value status-pass">{{ passing_ci }}</div>
                        <div class="stat-label">CI Passing</div>
                    </div>
                    <div class="stat">
                        <div class="stat-value status-fail">{{ failing_ci }}</div>
                        <div class="stat-label">CI Failing</div>
                    </div>
                </div>
            </div>

            {% for repo in repositories %}
            <div class="repo-card" id="{{ repo.name }}">
                <h2><a href="{{ repo.url }}">{{ repo.name }}</a></h2>

                {% if repo.last_commit %}
                <div class="commit-line">
                    <a href="{{ repo.url }}/commit/{{ repo.last_commit.sha }}"><code>{{ repo.last_commit.sha[:7] }}</code></a>
                    {{ repo.last_commit.message.split('\n')[0][:60] }}{% if repo.last_commit.message|length > 60 %}...{% endif %}
                    &middot; {{ repo.last_commit.author }}
                    &middot; {{ repo.last_commit.date.strftime('%Y-%m-%d') if repo.last_commit.date.strftime else repo.last_commit.date[:10] }}
                </div>
                {% endif %}

                {% if repo.open_prs %}
                <div class="section">
                    <h3>Open Pull Requests ({{ repo.open_prs|length }})</h3>
                    <table>
                        <thead>
                            <tr><th>#</th><th>Title</th><th>Author</th><th>Age</th></tr>
                        </thead>
                        <tbody>
                        {% for pr in repo.open_prs %}
                            <tr>
                                <td><a href="{{ pr.url }}">#{{ pr.number }}</a></td>
                                <td>{{ pr.title }}</td>
                                <td>@{{ pr.author }}</td>
                                <td>{{ pr.age_days }}d</td>
                            </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% endif %}

                {% if repo.branches_without_prs %}
                <div class="section">
                    <h3>Branches Without PRs ({{ repo.branches_without_prs|length }})</h3>
                    <ul>
                    {% for branch in repo.branches_without_prs %}
                        <li><code>{{ branch }}</code></li>
                    {% endfor %}
                    </ul>
                </div>
                {% endif %}

                {% if repo.github_pages_enabled %}
                <div class="pages-link">
                    <a href="{{ repo.github_pages_url }}">GitHub Pages</a>
                </div>
                {% endif %}

                {% if repo.ci_status != 'no_ci' and repo.ci_status != 'unknown' %}
                <div class="ci-status">
                    CI:
                    {% if repo.ci_status == 'success' %}
                    <span class="badge badge-success">PASS</span>
                    {% elif repo.ci_status == 'failure' %}
                    <span class="badge badge-failure">FAIL</span>
                    {% elif repo.ci_status == 'pending' %}
                    <span class="badge">PENDING</span>
                    {% endif %}
                </div>
                {% endif %}
            </div>
            {% endfor %}

            <footer style="text-align: center; padding: 20px; color: #57606a;">
                <em>Generated by GitHub Project Monitor</em>
            </footer>
        </main>
    </div>
</body>
</html>
